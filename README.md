# Spotify日本語曲プレイリスト自動生成システム

お気に入りの曲（Liked Songs）から日本語の曲だけを自動で抽出し、専用のプレイリストを毎日更新する自動化システムです。

![GIFアニメーション or スクリーンショット](attachment:6e0d9b92-1aad-41a0-9efe-02e9155fc2db:スクリーンショット_2025-10-06_013712.png)

---

## 1. プロジェクト概要

このプロジェクトは、Spotify APIを利用して、ユーザーの「お気に入りの曲」の中から独自の基準で日本語の楽曲を判別し、特定のプレイリストに自動で追加・更新するPythonアプリケーションです。GitHub Actionsを利用することで、毎日定時に自動実行されるように構築されています。

## 2. 背景・課題

普段から様々な国の音楽を聴くため、Spotifyの「お気に入りの曲」にはJ-POP、K-POP、洋楽などが混在していました。しかし、「今は日本の曲だけを集中して聴きたい」と思うことが頻繁にあり、そのたびに手動でプレイリストを作成するのは非常に手間でした。この個人的な課題を、API連携と自動化の技術を用いて解決したいと考えたのが、開発のきっかけです。

## 3. 主な機能

- **楽曲の自動抽出:** Spotifyの「お気に入りの曲」から全楽曲データを取得します。
- **日本語楽曲の判定:** 以下の複合的な基準に基づいて、日本語の楽曲かどうかを判定します。
    - アーティストに付与されているジャンル情報（`j-pop`, `anime`など）
    - 曲名に含まれる日本語の文字（ひらがな、カタカナ、漢字）
- **プレイリストの自動更新:**
    - 抽出した日本語楽曲を、専用のプレイリストに自動で追加します。
    - 差分同期のロジックを実装し、既に追加済みの曲が重複しないように管理します。
- **定時実行:** GitHub Actionsを利用し、毎日定時にシステムを自動実行します。

## 4. 使用技術・アーキテクチャ

このシステムは、以下の技術スタックで構築されています。

- **言語:** Python 3.10
- **主要ライブラリ:**
    - `spotipy`: Spotify Web APIを操作するためのPythonクライアント
- **認証:** OAuth 2.0 (Authorization Code Flow)
- **バージョン管理:** Git / GitHub
- **自動化 (CI/CD):** GitHub Actions

### アーキテクチャ図（簡易版）

[Spotify API] <--> [Python Script (spotipy)] --> [Japanese Playlist]
^
| (Scheduled Run)
|
[GitHub Actions]

## 5. 使い方・セットアップ方法

1. **リポジトリをクローン:**
    
    ```bash
    git clone [<https://github.com/H4aruki/Make-Japanese-Playlist-by-Spotify.git>](<https://github.com/H4aruki/Make-Japanese-Playlist-by-Spotify.git>)
    
    ```
    
2. **Spotify for Developersでアプリ登録:**
    - Client IDとClient Secretを取得します。
    - Redirect URIに `http://127.0.0.1:8888/callback` を登録します。
3. **GitHub Secretsの設定:**
    - リポジトリの`Settings` > `Secrets`に以下の情報を登録します。
        - `CLIENT_ID`
        - `CLIENT_SECRET`
        - `TARGET_PLAYLIST_ID`
        - `SPOTIPY_CACHE`（初回認証で生成した`.cache`ファイルの中身）
4. **自動実行:**
    - 上記設定後、`.github/workflows/`内の設定に基づき、5分ごと（または設定したスケジュール）に自動で実行されます。

## 6. 工夫した点・学んだこと

- **APIの制約への対応:** 一度に100曲までしか取得・追加できないというAPIの制約に対し、ページネーション処理やチャンク分割処理を実装することで、数千曲規模のプレイリストにも対応できるようにしました。
- **認証フローの自動化:** GitHub Actionsのような非対話環境では、ブラウザを開く初回認証が実行できません。この問題を解決するため、ローカルで一度発行したリフレッシュトークンを含む`.cache`ファイルの中身を`Secrets`に登録し、実行時に復元することで、非対話環境での認証を成功させました。
- **Gitのコンフリクト解決:** 開発過程で、ローカルとリモートの歴史が食い違う`unrelated histories`エラーやマージコンフリクトに直面しました。`git pull --allow-unrelated-histories`や、コンフリクトマーカーの手動修正など、Gitの強力なバージョン管理機能を実践的に学び、問題を解決しました。

## 7. 今後の課題

- Webフレームワーク（Flask, Djangoなど）を利用したUIの実装
- 日本語判定ロジックのさらなる精度向上
- エラー発生時の通知機能（LINE Notifyなどとの連携）

---
